# =============================================================================
# Lab Utils Menu Configuration
# =============================================================================
#
# YAML-driven menu structure for lab-utils interactive interface.
#
# ITEM TYPES (determined by 'type' field or structure):
# -----------------------------------------------------
#
#   type: script (default)
#     Execute a script file. id is path relative to lab-utils.d/
#     - id: "test-cuda.sh"
#       name: "Test CUDA"
#       description: "Run CUDA tests"
#
#   type: command
#     Execute a shell command. id is the command string.
#     - id: "nvidia-smi --query-gpu=name --format=csv"
#       name: "GPU Status"
#       description: "Show GPU information"
#       type: command
#
#   type: submenu (implicit when 'submenu' field present)
#     Static list of child items.
#     - name: "Git Utils"
#       submenu:
#         - id: "git-utils.d/git-pull-repos.sh"
#           name: "Pull All Repos"
#           description: "Pull from all repositories"
#
#   type: dynamic (implicit when 'scan_dir' field present)
#     Scans directory at runtime for executable scripts.
#     - name: "Local Scripts"
#       scan_dir: "~/.local/lab-utils.d"
#
#   Combined (submenu + scan_dir)
#     Static items plus dynamically discovered scripts.
#     - name: "Install Conda Env"
#       submenu:
#         - id: "install-conda-env.d/tensorflow.sh"
#           name: "TensorFlow"
#           description: "Install TensorFlow"
#       scan_dir: "~/.local/conda-env.d"
#
#   type: selector
#     Shows selection UI for configuration options.
#
#     OPTIONS - where to get the list of choices:
#       options:         Inline list of value/label pairs
#       options_script:  Script returning JSON array [{value, label}, ...]
#       options_cmd:     Shell command returning JSON array
#
#     CURRENT VALUE - how to detect currently selected option (marked in UI):
#       current:         Literal value string
#       current_script:  Script returning current value
#       current_cmd:     Shell command returning current value
#
#     APPLY ACTION - what happens when user selects an option:
#       apply_script:    Script to execute (from lab-utils.lib/)
#       apply_cmd:       Shell command to execute
#       apply_args:      Extra arguments prepended before selected value
#
#     EXECUTION: apply_script/apply_cmd is called with apply_args + selected value
#       Example: apply_script="set-profile-var", apply_args="MY_VAR", value="/bin/bash"
#       Executes: set-profile-var MY_VAR /bin/bash
#                                 ^       ^
#                            apply_args  selected value
#
#     Example with inline options:
#     - name: "Default Shell"
#       selector:
#         options:
#           - value: "/bin/bash"
#             label: "Bash"
#           - value: "/usr/bin/fish"
#             label: "Fish"
#         current_cmd: "grep -oP 'MY_VAR=\"\\K[^\"]*' ~/.profile"
#         apply_script: "set-profile-var"
#         apply_args: "JUPYTERLAB_TERMINAL_SHELL"
#
#     Example with dynamic options:
#     - name: "Default Conda Env"
#       selector:
#         options_script: "conda-env-options"
#         current_cmd: "grep -oP 'CONDA_DEFAULT_ENV=\"\\K[^\"]*' ~/.profile"
#         apply_script: "set-profile-var"
#         apply_args: "CONDA_DEFAULT_ENV"
#
# =============================================================================

menu:
  title: "Lab Utils"
  items:
    # Configure default shell, conda environment, and AWS profile
    - name: "Set Defaults"
      submenu:
        - name: "Default Shell"
          description: "Configure default terminal shell"
          selector:
            options:
              - value: "/bin/bash"
                label: "Bash"
              - value: "/usr/bin/fish"
                label: "Fish"
            current_cmd: "grep -oP 'JUPYTERLAB_TERMINAL_SHELL=\"\\K[^\"]*' ~/.profile 2>/dev/null"
            apply_script: "set-profile-var"
            apply_args: "JUPYTERLAB_TERMINAL_SHELL"

        - name: "Default Conda Env"
          description: "Set default conda environment"
          selector:
            options_script: "conda-env-options"
            current_cmd: "grep -oP 'CONDA_DEFAULT_ENV=\"\\K[^\"]*' ~/.profile 2>/dev/null"
            apply_script: "set-profile-var"
            apply_args: "CONDA_DEFAULT_ENV"

        - name: "Default AWS Profile"
          description: "Configure default AWS CLI profile"
          selector:
            options_script: "aws-profile-options"
            current_cmd: "grep -oP 'AWS_PROFILE=\"\\K[^\"]*' ~/.profile 2>/dev/null"
            apply_script: "set-profile-var"
            apply_args: "AWS_PROFILE"

    # Batch git operations across all workspace repositories
    - name: "Git Utils"
      submenu:
        - id: "git-utils.d/git-pull-repos.sh"
          name: "Pull All Repos"
          description: "Pull latest changes from all git repositories"
        - id: "git-utils.d/git-push-repos.sh"
          name: "Push All Repos"
          description: "Push local commits to all git repositories"
        - id: "git-utils.d/git-commit-repos.sh"
          name: "Commit All Repos"
          description: "Commit changes in all git repositories"
        - id: "git-utils.d/git-pull-submodules.sh"
          name: "Pull Submodules"
          description: "Update all git submodules recursively"

    # Install additional conda environments (TensorFlow, PyTorch, R, Rust)
    - name: "Install Extra Environments"
      submenu:
        - id: "install-conda-env.d/tensorflow.sh"
          name: "TensorFlow"
          description: "Install TensorFlow deep learning environment"
          marker: "conda"
        - id: "install-conda-env.d/torch.sh"
          name: "PyTorch"
          description: "Install PyTorch deep learning environment"
          marker: "conda"
        - id: "install-conda-env.d/r.sh"
          name: "R"
          description: "Install R statistical computing environment"
          marker: "conda"
        - id: "install-conda-env.d/rust.sh"
          name: "Rust"
          description: "Install Rust programming environment"
          marker: "conda"
      scan_dir: "~/.local/extra-env.d"

    # Install AI coding assistants (Claude Code, Cursor, Gemini, Codex)
    - name: "Install AI Assistant"
      submenu:
        - id: "install-ai-assistant.d/anthropic-claude-code.sh"
          name: "Anthropic Claude Code"
          description: "Install Claude Code AI assistant CLI"
        - id: "install-ai-assistant.d/anysphere-cursor.sh"
          name: "Anysphere Cursor"
          description: "Install Cursor AI-powered code editor"
        - id: "install-ai-assistant.d/google-gemini-cli.sh"
          name: "Google Gemini CLI"
          description: "Install Google Gemini AI assistant CLI"
        - id: "install-ai-assistant.d/openai-codex.sh"
          name: "OpenAI Codex"
          description: "Install OpenAI Codex AI assistant"

    # Install Docker CLI and plugins to /opt/docker
    - id: "install-docker-cli.sh"
      name: "Install Docker CLI"
      description: "Install Docker CLI tools to /opt/docker"

    # Create new project from Copier template
    - id: "new-project.sh"
      name: "New Project"
      description: "Scaffold new data science project using Copier"

    # Verify GPU and CUDA configuration
    - id: "test-cuda.sh"
      name: "Test CUDA"
      description: "Test CUDA GPU support with TensorFlow and PyTorch"

    # User-defined scripts from ~/.local/lab-utils.d/
    - name: "Local Scripts"
      scan_dir: "~/.local/lab-utils.d"
