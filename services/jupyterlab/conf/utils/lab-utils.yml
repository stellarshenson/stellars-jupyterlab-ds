# =============================================================================
# Lab Utils Menu Configuration
# =============================================================================
#
# YAML-driven menu structure for lab-utils interactive interface.
#
# ITEM TYPES (determined by 'type' field or structure):
# -----------------------------------------------------
#
#   type: script (default)
#     Execute a script file. id is path relative to lab-utils.d/
#     - id: "test-cuda.sh"
#       name: "Test CUDA"
#       description: "Run CUDA tests"
#
#   type: command
#     Execute a shell command. id is the command string.
#     - id: "nvidia-smi --query-gpu=name --format=csv"
#       name: "GPU Status"
#       description: "Show GPU information"
#       type: command
#
#   type: submenu (implicit when 'submenu' field present)
#     Static list of child items.
#     - name: "Git Utils"
#       submenu:
#         - id: "git-utils.d/git-pull-repos.sh"
#           name: "Pull All Repos"
#           description: "Pull from all repositories"
#
#   type: dynamic (implicit when 'scan_dir' field present)
#     Scans directory at runtime for executable scripts.
#     - name: "Local Scripts"
#       scan_dir: "~/.local/lab-utils.d"
#
#   type: menu_file (implicit when 'menu_file' field present)
#     Loads submenu items from an external YAML file at runtime.
#     File format - dict with items key (optional name for submenu title):
#       name: "Campaign Tools"
#       items:
#         - id: "script.sh"
#           name: "My Script"
#           description: "Does something"
#     File format - bare list:
#       - id: "script.sh"
#         name: "My Script"
#     The 'name' field is used as submenu title when loaded from
#     JUPYTERLAB_AUX_MENU_PATH; falls back to filename stem.
#     Graceful: returns empty if file doesn't exist.
#     - name: "Campaign Tools"
#       menu_file: "/mnt/shared/campaign-menu.yml"
#
#   Combined (submenu + menu_file + scan_dir)
#     Static items, then file-loaded items, then directory-scanned items.
#     - name: "Install Conda Env"
#       submenu:
#         - id: "install-conda-env.d/tensorflow.sh"
#           name: "TensorFlow"
#           description: "Install TensorFlow"
#       menu_file: "~/.local/extra-env-menu.yml"
#       scan_dir: "~/.local/conda-env.d"
#
#   type: selector
#     Shows selection UI for configuration options.
#
#     OPTIONS - where to get the list of choices:
#       options:         Inline list of value/label pairs
#       options_script:  Script returning JSON array [{value, label}, ...]
#       options_cmd:     Shell command returning JSON array
#
#     CURRENT VALUE - how to detect currently selected option (marked in UI):
#       current:         Literal value string
#       current_script:  Script returning current value
#       current_cmd:     Shell command returning current value
#
#     APPLY ACTION - what happens when user selects an option:
#       apply_script:    Script to execute (from lab-utils.lib/)
#       apply_cmd:       Shell command to execute
#       apply_args:      Extra arguments prepended before selected value
#
#     EXECUTION: apply_script/apply_cmd is called with apply_args + selected value
#       Example: apply_script="set-profile-var", apply_args="MY_VAR", value="/bin/bash"
#       Executes: set-profile-var MY_VAR /bin/bash
#                                 ^       ^
#                            apply_args  selected value
#
#     Example with inline options:
#     - name: "Default Shell"
#       selector:
#         options:
#           - value: "/bin/bash"
#             label: "Bash"
#           - value: "/usr/bin/fish"
#             label: "Fish"
#         current_cmd: "grep -oP 'MY_VAR=\"\\K[^\"]*' ~/.profile"
#         apply_script: "set-profile-var"
#         apply_args: "JUPYTERLAB_TERMINAL_SHELL"
#
#     Example with dynamic options:
#     - name: "Default Conda Env"
#       selector:
#         options_script: "conda-env-options"
#         current_cmd: "grep -oP 'CONDA_DEFAULT_ENV=\"\\K[^\"]*' ~/.profile"
#         apply_script: "set-profile-var"
#         apply_args: "CONDA_DEFAULT_ENV"
#
# AUXILIARY MENU (JUPYTERLAB_AUX_MENU_PATH):
# -------------------------------------------
#
#   When the JUPYTERLAB_AUX_MENU_PATH env var is set, lab-utils scans
#   the directory and injects an "Auxiliary Menu" submenu before
#   "Local Scripts". Useful for admin-provisioned tools via shared volume.
#
#   Directory contents are handled by file type:
#     - Executable scripts -> direct menu items (marker: "aux")
#     - YAML files (.yml/.yaml) -> submenus loaded via menu_file
#
#   YAML files can provide their own submenu name via a top-level
#   'name' field; otherwise the filename stem is used.
#
#   Example directory layout:
#     /mnt/shared/lab-utils.d/
#       setup-aws.sh             # executable -> menu item "setup-aws"
#       hackathon-tools.yml      # YAML -> submenu
#
#   Example YAML file (hackathon-tools.yml):
#     name: "Hackathon Tools"
#     items:
#       - id: "echo 'team setup complete'"
#         name: "Team Setup"
#         description: "Configure team environment"
#         type: command
#       - id: "/mnt/shared/scripts/submit.sh"
#         name: "Submit Solution"
#         description: "Package and submit hackathon solution"
#
# =============================================================================

menu:
  title: "Lab Utils"
  items:
    # Configure default shell, conda environment, and AWS profile
    - name: "Set Defaults"
      submenu:
        - name: "Default Shell"
          description: "Configure default terminal shell"
          selector:
            options:
              - value: "/bin/bash"
                label: "Bash"
              - value: "/usr/bin/fish"
                label: "Fish"
            current_cmd: "grep -oP 'JUPYTERLAB_TERMINAL_SHELL=\"\\K[^\"]*' ~/.profile 2>/dev/null"
            apply_script: "set-profile-var"
            apply_args: "JUPYTERLAB_TERMINAL_SHELL"

        - name: "Default Conda Env"
          description: "Set default conda environment"
          selector:
            options_script: "conda-env-options"
            current_cmd: "grep -oP 'CONDA_DEFAULT_ENV=\"\\K[^\"]*' ~/.profile 2>/dev/null"
            apply_script: "set-profile-var"
            apply_args: "CONDA_DEFAULT_ENV"

        - name: "Default AWS Profile"
          description: "Configure default AWS CLI profile"
          selector:
            options_script: "aws-profile-options"
            current_cmd: "grep -oP 'AWS_PROFILE=\"\\K[^\"]*' ~/.profile 2>/dev/null"
            apply_script: "set-profile-var"
            apply_args: "AWS_PROFILE"

    # Batch git operations across all workspace repositories
    - name: "Git Utils"
      submenu:
        - id: "git-utils.d/git-pull-repos.sh"
          name: "Pull All Repos"
          description: "Pull latest changes from all git repositories"
        - id: "git-utils.d/git-push-repos.sh"
          name: "Push All Repos"
          description: "Push local commits to all git repositories"
        - id: "git-utils.d/git-commit-repos.sh"
          name: "Commit All Repos"
          description: "Commit changes in all git repositories"
        - id: "git-utils.d/git-pull-submodules.sh"
          name: "Pull Submodules"
          description: "Update all git submodules recursively"

    # Install additional conda environments (TensorFlow, PyTorch, R, Rust)
    - name: "Install Extra Environments"
      submenu:
        - id: "install-conda-env.d/tensorflow.sh"
          name: "TensorFlow"
          description: "Install TensorFlow deep learning environment"
          marker: "conda"
        - id: "install-conda-env.d/torch.sh"
          name: "PyTorch"
          description: "Install PyTorch deep learning environment"
          marker: "conda"
        - id: "install-conda-env.d/r.sh"
          name: "R"
          description: "Install R statistical computing environment"
          marker: "conda"
        - id: "install-conda-env.d/rust.sh"
          name: "Rust"
          description: "Install Rust programming environment"
          marker: "conda"
      scan_dir: "~/.local/extra-env.d"

    # Install AI coding assistants (Claude Code, OpenCode, Cursor, Gemini, Codex)
    - name: "Install AI Assistant"
      submenu:
        - id: "install-ai-assistant.d/anthropic-claude-code.sh"
          name: "Anthropic Claude Code"
          description: "Install Claude Code AI assistant CLI"
        - id: "install-ai-assistant.d/opencode-ai.sh"
          name: "OpenCode"
          description: "Install OpenCode open source AI assistant CLI"
        - id: "install-ai-assistant.d/anysphere-cursor.sh"
          name: "Anysphere Cursor"
          description: "Install Cursor AI-powered code editor"
        - id: "install-ai-assistant.d/google-gemini-cli.sh"
          name: "Google Gemini CLI"
          description: "Install Google Gemini AI assistant CLI"
        - id: "install-ai-assistant.d/openai-codex.sh"
          name: "OpenAI Codex"
          description: "Install OpenAI Codex AI assistant"

    # Install Docker CLI and plugins to /opt/docker
    - id: "install-docker-cli.sh"
      name: "Install Docker CLI"
      description: "Install Docker CLI tools to /opt/docker"

    # Create new project from Copier template
    - id: "new-project.sh"
      name: "New Project"
      description: "Scaffold new data science project using Copier"

    # Verify GPU and CUDA configuration
    - id: "test-cuda.sh"
      name: "Test CUDA"
      description: "Test CUDA GPU support with TensorFlow and PyTorch"

    # User-defined scripts from ~/.local/lab-utils.d/
    - name: "Local Scripts"
      scan_dir: "~/.local/lab-utils.d"
